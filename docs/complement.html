<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Macroeconomic 3 Presentation - Complement</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./../"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Our presentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./slides/slides.pdf"> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./complement.html" aria-current="page"> 
<span class="menu-text">Complement</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Paulogcd/Macroeconomics-3-Presentation"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#wealth-inequality" id="toc-wealth-inequality" class="nav-link" data-scroll-target="#wealth-inequality">Wealth inequality</a></li>
  <li><a href="#natural-hazard-and-wealth-inequality" id="toc-natural-hazard-and-wealth-inequality" class="nav-link" data-scroll-target="#natural-hazard-and-wealth-inequality">Natural Hazard and Wealth Inequality</a></li>
  <li><a href="#research-design" id="toc-research-design" class="nav-link" data-scroll-target="#research-design">Research Design</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#measurement" id="toc-measurement" class="nav-link" data-scroll-target="#measurement">Measurement</a>
  <ul class="collapse">
  <li><a href="#wealth-trajectories" id="toc-wealth-trajectories" class="nav-link" data-scroll-target="#wealth-trajectories">Wealth Trajectories</a></li>
  <li><a href="#natural-hazard-damages" id="toc-natural-hazard-damages" class="nav-link" data-scroll-target="#natural-hazard-damages">Natural Hazard Damages</a></li>
  <li><a href="#other-key-variables" id="toc-other-key-variables" class="nav-link" data-scroll-target="#other-key-variables">Other Key Variables</a></li>
  <li><a href="#control-variables" id="toc-control-variables" class="nav-link" data-scroll-target="#control-variables">Control Variables</a></li>
  </ul></li>
  <li><a href="#sampling-and-modeling" id="toc-sampling-and-modeling" class="nav-link" data-scroll-target="#sampling-and-modeling">Sampling and Modeling</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#natural-hazard-damages-and-wealth-inequality" id="toc-natural-hazard-damages-and-wealth-inequality" class="nav-link" data-scroll-target="#natural-hazard-damages-and-wealth-inequality">Natural Hazard Damages and Wealth Inequality</a></li>
  <li><a href="#fema-aid-and-wealth-inequality" id="toc-fema-aid-and-wealth-inequality" class="nav-link" data-scroll-target="#fema-aid-and-wealth-inequality">FEMA Aid and Wealth Inequality</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Complement</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This complement aims to summarize in a detailed fashion the following article for our Macroeconomics 3 presentation.</p>
<blockquote class="blockquote">
<p>Article : Junia Howell, James R. Elliott, Damages Done: The Longitudinal Impacts of Natural Hazards on Wealth Inequality in the United States, available <a href="https://academic.oup.com/socpro/article-abstract/66/3/448/5074453?redirectedFrom=fulltext">here</a>.</p>
</blockquote>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>There exists rising wealth inequality. Economic research tries to explain it by (1) income, (2) differential in Return on Investment (RoI), (3) policies. Without rejecting those approaches, this paper tries to use natural hazard damages to explain wealth inequality.</p>
<p>The main reasons to care about the effect of natural hazard on wealth inequalities are :</p>
<ul>
<li>Its scale : it is very costly,</li>
<li>Its scope : 99,7% of the US counties have been affected by it since 2000,</li>
<li>Its trajectory : with optimistic scenarios, the damages from natural hazards are projected to at least double (or quadruple) in 2050.</li>
</ul>
<p>Research already showed tha poor people recover less than rich from natural hazard, even in relative terms. Also, research underlines the key role of recovery resources, and not only physical damages received. Globally, there is a consensus on this literature about the importance of the relationships between natural hazard and pre-existing social inequalities, and not studying natural hazards alone.</p>
<section id="wealth-inequality" class="level2">
<h2 class="anchored" data-anchor-id="wealth-inequality">Wealth inequality</h2>
<p>The authors point out that U.S. wealth inequalities have exploded recently, and define three ways of wealth accumulation :</p>
<ol type="1">
<li>Wages in the short term,</li>
<li>Investment (linked to RoI) in the long term,</li>
<li>Intergenerational transfers at the life term.</li>
</ol>
<p>Given that wealth has major effect on several other variables, such as (1) education performances, education inequalities, (2) physical health, and (3) emotional well-being, it is a crucial matter. They also recall that income and wages have strongly decreased for middle and low wage workes. For Investment and Long term factors of wealth accumulaition, the authors point out the role of the real estate markets in the increase of inequalities. Finally, the differences of interest rates on loans have strongly risen, especially with the 2008 crisis that affected poor people more strongly. Globally, wealth inequality has strongly increased at the extremities of the wealth distribution, and policies have participated to increasing inequality.</p>
</section>
<section id="natural-hazard-and-wealth-inequality" class="level2">
<h2 class="anchored" data-anchor-id="natural-hazard-and-wealth-inequality">Natural Hazard and Wealth Inequality</h2>
<p>In this paper, they put the focus on natural hazard with physical damage on property and assets, which can be public or private. Historically, they identify the year of 1755, with the earthbreak in Lisboa, as the begin of the development of an answer from the State. In the US, the public action in insurance against natural hazard begins in the early 1800s, with 1803 tariffs to help victimes of fire damages. In 1811 and 1812, lands are freely given to victims of displacement, and in the 1830s, there exists a <em>de facto</em> policy of federal disaster assistance. In 1950, the Disaster Relief Act (DRA) is the main milestone for the natural hazard protection policy in the US. It allows for :</p>
<ol type="1">
<li>Immediate relief (through housing for example),</li>
<li>Hazard insurance programs,</li>
<li>Rebuilding damaged infrastructure,</li>
<li>Low-interest loans.</li>
</ol>
<p>Under other institutions, the authors identify the Federal Emergency Management Agency (FEMA) as a key one. It is responsible for redistribution of money in natural hazard periods. They also mention the existence of the National Flood Insurance Program (NFIP), which is currently the biggest hazard insurer of the US.</p>
<p>The author underline the fact that private and public assistance are focused on restoration of property and wealth, which implies differences in recovery rate and quality in function of the initial wealth of the insured people. Also, they point out that poor and non-property owners people are more exposed to risks after natural hazards such as :</p>
<ol type="1">
<li>Job loss,</li>
<li>Having to move (displacement),</li>
<li>Having to pay a higher rent,</li>
<li>Experimenting a decrease in savings.</li>
</ol>
<p>They also mention that in some cases, there is often a reduction or a suspension in working conditions protection policies after natural hazards, and they give the example of regulation suspension after the hurricane Katrina.</p>
</section>
<section id="research-design" class="level2">
<h2 class="anchored" data-anchor-id="research-design">Research Design</h2>
<p>The authors then present their research design. They use panel data to study the effect of hazards damages on wealth distribution. This effect differs in function of the considered populations, and vary especially strongly when race, education level, and ownership are considered. They also want to test two hypothesis :</p>
<ol type="1">
<li>Private insurance does not totally prevent increase in wealth inequality from hazards damages.</li>
<li>The FEMA aid (in net terms) differs in population and contributes to wealth inequality.</li>
</ol>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The authors now present the used data. They begin with the Panel Study of Income Dynamics (PSID), a panel dataset that track US families from a “representative sample” from 1968 to now, with information on county and neighbourhood information. They also use the Spatial Hazard Events and Losses Database (SHELD), that is maintained by the Hazards and Vulnerability Research Institute (HVRI) since 1960 until now. In this dataset, 18 types of natural hazards and their link with (1) fatalities and (2) property damages, are taken into account. They also make use of the Devennial Census Long form for contextualizationn, and finally use the FEMA Projects Summary to take into account the FEMA aid.</p>
</section>
<section id="measurement" class="level2">
<h2 class="anchored" data-anchor-id="measurement">Measurement</h2>
<section id="wealth-trajectories" class="level3">
<h3 class="anchored" data-anchor-id="wealth-trajectories">Wealth Trajectories</h3>
<p>For their model, they take the definition of Wealth as defined in the PSID dataset, where it is the sum, at the close family level, of :</p>
<ul>
<li>Saving accounts,</li>
<li>Checking accounts,</li>
<li>Real estate holdings,</li>
<li>Equity,</li>
<li>Vehicles,</li>
<li>Farms,</li>
<li>Businesses,</li>
<li>Stocks,</li>
<li>Annuities / IRAs,</li>
<li>Minus all reported debts.</li>
</ul>
<p>The distribution they get of the wealth is right-skewed, i.e.&nbsp;inflated by the very rich. To work with the data, they added a “global minimum” to all raw data, to avoid negative values due to debts, and used the squared root to compress the different wealth levels. Finally, they transformed the data to get a normal distribution.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Table_1.png" class="img-fluid figure-img"></p>
<figcaption>TABLE 1.</figcaption>
</figure>
</div>
</section>
<section id="natural-hazard-damages" class="level3">
<h3 class="anchored" data-anchor-id="natural-hazard-damages">Natural Hazard Damages</h3>
<p>In the SHELD dataset, the natural hazards damages correspond to the “direct damage to (non-crop) property” (p.454) variable, in dollars. They standardize it to the 2012 U.S. dollar value, and apply the natural log to get the levels of damages, due to the initial distribution being very right-skewed.</p>
</section>
<section id="other-key-variables" class="level3">
<h3 class="anchored" data-anchor-id="other-key-variables">Other Key Variables</h3>
<p>The authors underline the fact that some other key variables have to be taken into account. They identify three main dimensions of social stratification :</p>
<ol type="1">
<li>Race (4 mutually exclusive categories : white, black, latino (or hispanic), and “other”),</li>
<li>Education (in number of total years of school completed),</li>
<li>Homeowner status (1 or 0).</li>
</ol>
<p>To get the private insurance investment, they compute the sum of all premia paid for home and car coverage during the interview year. They point out that this level of data precision is not ideal, since different insurance plans could provoke very different reactions to hazard damages.</p>
<p>To get the Federal Assistance variable, they sum the non fire related FEMA aids. Here the authors detail a bit the process to get this help : First, when a natural hazard is too big to be handled by the county or the state, they ask the federal authorities. If the President declare the existence of a major disaster, the FEMA then takes action and proceed to money transfers and other kinds of help, such as : financial help, temporary housing, house voucher, uninsured personal needs, and sometimes even direct replacement of private property.</p>
</section>
<section id="control-variables" class="level3">
<h3 class="anchored" data-anchor-id="control-variables">Control Variables</h3>
<p>They also include several control variables, at three main levels : the individual, the neighhorhood, and the population. The individual level variables are :</p>
<ul>
<li>Age,</li>
<li>Foreign birth,</li>
<li>Marital status,</li>
<li>Number of children under 18 years old who are living within the household,</li>
<li>If the individuals have moved in the last two years.</li>
</ul>
<p>The variables at the neighborhood level are :</p>
<ul>
<li>The median income of the neighborhood,</li>
<li>The number of adults with at least a bachelor degree,</li>
<li>The number of adults currently employed.</li>
</ul>
<p>Finally, the variables at the population level are :</p>
<ul>
<li>The total population,</li>
<li>The urban-rural variable from 1 to 9, with one representing the most urban, and 9 the most rural.</li>
</ul>
</section>
</section>
<section id="sampling-and-modeling" class="level2">
<h2 class="anchored" data-anchor-id="sampling-and-modeling">Sampling and Modeling</h2>
<p>Historically, the choice of following the “head of the household” led to only men in the samples, which biased the data from the difference in marital status. The author did run one model per gender in the household, but due to very similar results, they only present the female model with at least four over seven interviews.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>The authors first mention the difference in aid against natural hazard damage between 1991-2001 and 2005-2007, showing a clear increase from $237 millions to $1,15 billion. Also, they mention that important disparities exist between some counties are especially affected by the phenomenon, giving the Linn County, in Iowa as an example.</p>
<section id="natural-hazard-damages-and-wealth-inequality" class="level3">
<h3 class="anchored" data-anchor-id="natural-hazard-damages-and-wealth-inequality">Natural Hazard Damages and Wealth Inequality</h3>
<p>They then refer to Table 2. This table presents several models that try to explain wealth by multiple variables, depending on the model. They first talk about the first model, that only takes the level of hazard damage and the year of the regression as explaning factors. In the second model, they include all the control variables mentioned previously, and they mention that the race variables have a clear negative effect on wealth.</p>
<p><img src="Table_2_1.png" class="img-fluid" alt="Table 2.1"> <img src="Table_2_2.png" class="img-fluid" alt="Table 2.2"></p>
<p>In the third model, they also include interaction between hazard and race variables. The effects of those interaction effects are strong and significant. The way to interpret them could be : for a Black person, being affected by a one percent hazard damage increase explains a wealth decrease of 0.1262% in wealth accumulation from one period to the next one. We can see graphically the effect of the race variable in the Panel A.</p>
<p>The authors then test for the effect of education in the next model. The panel B is a projection of the model that takes into account the education variable. On the x-axis is County Property Damage from Natural Hazards, and on the y-axis, there is “Wealth in 2013”. We can see the three panels of Figure 1 as answering the question : for a certain level of natural hazard damage, how much wealthy is a certain subgroup of the population ? We see clearly that less educated people are poorer and this wealth inequality is increasing with the amount of natural damage the county went through.</p>
<p>In the fifth Model, they take into consideration the homeownership. The interaction effects are done with the renter status. Similarly for race and education, they also find a positive relationship between homeownership and are richer in zones that are more exposed to natural hazards.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figure_1.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1</figcaption>
</figure>
</div>
<p>Testing all the variables, the authors find that the ones that cause the biggest wealth gap are race, education, and homeownership. They affirm that the difference of natural hazards effects on people mainly depend on those three variables. In the FIgure 2, they compare the wealth trajectory of an educated White owner and a 10-th grade Black renter.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figure_2.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2</figcaption>
</figure>
</div>
<p>Finally, in the last model, the authors also include privae insurance. First, they find that more private insurance predicts a bigger wealth accumulation, and seems therefore to confirm that it does bring larger payouts due to a better coverage. Secondly, including private insurance does not reduce the effect of the other three main factors (race, education, homeownership). In this sense, private insurance does not totally prevent wealth inequality increase due to natural hazards.</p>
</section>
<section id="fema-aid-and-wealth-inequality" class="level3">
<h3 class="anchored" data-anchor-id="fema-aid-and-wealth-inequality">FEMA Aid and Wealth Inequality</h3>
<p>Following the inclusion of private insurance test, they also include the FEMA aid. Their goal is to answer the question : Does the FEMA aid differ in function of wealth ? In Table 3, they try to explain the FEMA aid by hazard damge, controlling for total population, rurality scale and the year. They find that the effect exists, but is very weak, and not very robust. Therefore, they rerun the models (only five this time), but this time including the FEMA aid and private insurance premia.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Table_3.png" class="img-fluid figure-img"></p>
<figcaption>Table 3</figcaption>
</figure>
</div>
<p>The main conclusion one can draw from these models is that FEMA aid and wealth inequalities are positively linked. Also, Black and Latino people accumulate less when they live in counties that received a lot of FEMA aid, while the inverse is true for White people. The effect can be seen in the Interaction Terms of the Model 1. Each coefficient reflects the importance of belonging to the corresponding community and living in a county receiving FEMA aid from one period to another. In the second model, they take out race interaction terms, but take into account interaction term between FEMA and Education. In the third model, they include homeownership.</p>
<p><img src="Table_4_1.png" class="img-fluid" alt="Table 4.1"> <img src="Table_4_2.png" class="img-fluid" alt="Table 4.2"></p>
<p>They also run the models with interaction effects between the FEMA and othe control variables. They find that : “the more wealth one has, the more one benefits from living in a county that receives more FEMA aid”. The authors advance that the FEMA aid “polarize wealth along racial, educational, and initial wealth lines, as evidenced by the statistically significant interaction coefficient” (pp.461-464). Then, in Figure 3, they reproduce the Figure 2, but with FEMA Aid in the x-axis instead of the hazard damages.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figure_3.png" class="img-fluid figure-img"></p>
<figcaption>Figure 3</figcaption>
</figure>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Wealth inequalities are explained by different elements, and this paper aims to show that natural hazards damages are one of them. The authors underly the importance of taking into account the interaction between natural hazards damages and pre-existing social dynamics, such as race, education, and ownership. In that way, they advance that we should think more about the policies managing environmental hazards. They recognize that the precise understanding on how natural hazards polarize wealth inequality is still incomplete and thus insist on further research. They advocate for taking the aid into consideration in the study of wealth inequalities (“equal aid is not equitable aid”, p.465).</p>
<p>They advocate for a more important taking into consideration of the interactions between social and environmental dynamics. For that, they advance that viewing the U.S. society as an inequal and heterogeneous group would be better in comparison to a monolitic group view. They make a reference to Stalling (2002), and re-underly the fact that natural hazards are more detrimental to socially marginalized groups. They therefore advance that the FEMA help should try to mitigate more this phenomenon, contrary to what is happening right now. They conclude by saying that the FEMA is necessary, but that we just have to rethink how aid is brought.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>